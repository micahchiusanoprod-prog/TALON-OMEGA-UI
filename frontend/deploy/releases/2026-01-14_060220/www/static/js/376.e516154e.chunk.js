"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[376],{8083(e,t,n){n.r(t),n.d(t,{default:()=>A});var s=n(9950),o=n(9810),a=n(9029),l=n(7113),r=n(495),i=n(9995),c=n(2527),u=n.n(c);const p=(0,r.wk)(function(e,t){const n=new c.Popup(e,t.overlayContainer);return(0,i.Q)(n,t)},function(e,t,n,o){let{position:a}=n;(0,s.useEffect)(function(){const{instance:n}=e;function s(e){e.popup===n&&(n.update(),o(!0))}function l(e){e.popup===n&&o(!1)}return t.map.on({popupopen:s,popupclose:l}),null==t.overlayContainer?(null!=a&&n.setLatLng(a),n.openOn(t.map)):t.overlayContainer.bindPopup(n),function(){var e;t.map.off({popupopen:s,popupclose:l}),null===(e=t.overlayContainer)||void 0===e||e.unbindPopup(),t.map.removeLayer(n)}},[e,t,o,a])});n(5392);var d=n(8822),f=n(6391),m=n(5924),x=n(5833),h=n(2989),g=n(4414);const j="#22c55e",v="#f59e0b",y="#ef4444",w="#6b7280",N=e=>"offline"===e.status?"OFFLINE":"need_help"===e.user_status?"NEED HELP":"okay"===e.user_status?"OKAY":"good"===e.user_status?"GOOD":"UNKNOWN",k=e=>{if(!e)return"Unknown";const t=Math.floor((new Date-new Date(e))/6e4);return t<1?"just now":t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):"".concat(Math.floor(t/1440),"d ago")},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n='\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 36" width="32" height="48">\n      <path d="M12 0C5.4 0 0 5.4 0 12c0 7.2 12 24 12 24s12-16.8 12-24c0-6.6-5.4-12-12-12z" fill="'.concat(e,'" stroke="#fff" stroke-width="1"/>\n      <circle cx="12" cy="12" r="5" fill="#fff"/>\n      ').concat(t?'<circle cx="12" cy="12" r="7" fill="none" stroke="#fff" stroke-width="1" opacity="0.5"><animate attributeName="r" values="7;10;7" dur="1s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.5;0;0.5" dur="1s" repeatCount="indefinite"/></circle>':"","\n    </svg>\n  ");return u().divIcon({className:"custom-map-marker",html:n,iconSize:[32,48],iconAnchor:[16,48],popupAnchor:[0,-48]})},_={good:b(j,!1),okay:b(v,!1),need_help:b(y,!0),offline:b(w,!1)},C=e=>{let{node:t}=e;const n=(e=>"offline"===e.status?d.A:"need_help"===e.user_status?f.A:"okay"===e.user_status?m.A:x.A)(t),s=(e=>"offline"===e.status?w:"need_help"===e.user_status?y:"okay"===e.user_status?v:j)(t);return(0,g.jsxs)("div",{className:"min-w-[180px] p-1","data-testid":"map-popup-".concat(t.node_id),children:[(0,g.jsx)("div",{className:"font-semibold text-foreground text-sm mb-1",children:t.name}),(0,g.jsxs)("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium mb-2",style:{backgroundColor:"".concat(s,"20"),color:s},children:[(0,g.jsx)(n,{className:"w-3 h-3"}),N(t)]}),(0,g.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{children:"Last seen:"}),(0,g.jsx)("span",{className:"font-medium",children:k(t.last_seen)})]}),t.gps?(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{children:"Location:"}),(0,g.jsxs)("span",{className:"font-mono text-xs",children:[t.gps.lat.toFixed(4),", ",t.gps.lon.toFixed(4)]})]}):(0,g.jsx)("div",{className:"text-muted-foreground italic",children:"No GPS data"}),t.role&&(0,g.jsxs)("div",{className:"flex justify-between",children:[(0,g.jsx)("span",{children:"Role:"}),(0,g.jsx)("span",{className:"font-medium",children:t.role})]})]})]})};function A(e){let{nodesWithGps:t,defaultCenter:n,defaultZoom:r,onMapReady:i}=e;const[c,u]=(0,s.useState)(!1),d=(0,s.useRef)(null);return(0,s.useEffect)(()=>{const e=setTimeout(()=>u(!0),50);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{d.current&&i&&i(d.current)},[c,i]),c?(0,g.jsxs)(o.W,{ref:d,center:n,zoom:r,className:"h-[320px] lg:h-[450px] xl:h-[550px] w-full rounded-lg z-0",style:{background:"hsl(var(--muted))"},"data-testid":"ally-map-container",children:[(0,g.jsx)(a.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map(e=>{const t=(e=>"offline"===e.status?_.offline:"need_help"===e.user_status?_.need_help:"okay"===e.user_status?_.okay:_.good)(e);return t&&e.gps?(0,g.jsx)(l.p,{position:[e.gps.lat,e.gps.lon],icon:t,children:(0,g.jsx)(p,{children:(0,g.jsx)(C,{node:e})})},e.node_id):null})]}):(0,g.jsx)("div",{className:"h-[320px] lg:h-[450px] xl:h-[550px] glass rounded-lg flex items-center justify-center",children:(0,g.jsxs)("div",{className:"text-center",children:[(0,g.jsx)(h.A,{className:"w-8 h-8 animate-spin text-primary mx-auto mb-2"}),(0,g.jsx)("p",{className:"text-sm text-muted-foreground",children:"Initializing map..."})]})})}}}]);