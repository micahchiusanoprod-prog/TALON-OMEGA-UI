{"version":3,"file":"static/js/623.67d2bcd6.chunk.js","mappings":"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","sources":["../node_modules/react-leaflet/lib/Popup.js","components/ally/LazyMapContent.jsx"],"sourcesContent":["import { createElementObject, createOverlayComponent } from '@react-leaflet/core';\nimport { Popup as LeafletPopup } from 'leaflet';\nimport { useEffect } from 'react';\nexport const Popup = createOverlayComponent(function createPopup(props, context) {\n    const popup = new LeafletPopup(props, context.overlayContainer);\n    return createElementObject(popup, context);\n}, function usePopupLifecycle(element, context, { position }, setOpen) {\n    useEffect(function addPopup() {\n        const { instance } = element;\n        function onPopupOpen(event) {\n            if (event.popup === instance) {\n                instance.update();\n                setOpen(true);\n            }\n        }\n        function onPopupClose(event) {\n            if (event.popup === instance) {\n                setOpen(false);\n            }\n        }\n        context.map.on({\n            popupopen: onPopupOpen,\n            popupclose: onPopupClose\n        });\n        if (context.overlayContainer == null) {\n            // Attach to a Map\n            if (position != null) {\n                instance.setLatLng(position);\n            }\n            instance.openOn(context.map);\n        } else {\n            // Attach to container component\n            context.overlayContainer.bindPopup(instance);\n        }\n        return function removePopup() {\n            context.map.off({\n                popupopen: onPopupOpen,\n                popupclose: onPopupClose\n            });\n            context.overlayContainer?.unbindPopup();\n            context.map.removeLayer(instance);\n        };\n    }, [\n        element,\n        context,\n        setOpen,\n        position\n    ]);\n});\n","import React, { useEffect, useState, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { HelpCircle, CheckCircle, Circle, WifiOff, AlertTriangle, Loader2 } from 'lucide-react';\n\n// Status color mapping for pins\nconst statusColors = {\n  good: '#22c55e',      // green-500\n  okay: '#f59e0b',      // amber-500\n  need_help: '#ef4444', // red-500\n  offline: '#6b7280',   // gray-500\n};\n\nconst getNodeStatusColor = (node) => {\n  if (node.status === 'offline') return statusColors.offline;\n  if (node.user_status === 'need_help') return statusColors.need_help;\n  if (node.user_status === 'okay') return statusColors.okay;\n  return statusColors.good;\n};\n\nconst getStatusLabel = (node) => {\n  if (node.status === 'offline') return 'OFFLINE';\n  if (node.user_status === 'need_help') return 'NEED HELP';\n  if (node.user_status === 'okay') return 'OKAY';\n  if (node.user_status === 'good') return 'GOOD';\n  return 'UNKNOWN';\n};\n\nconst getStatusIcon = (node) => {\n  if (node.status === 'offline') return WifiOff;\n  if (node.user_status === 'need_help') return HelpCircle;\n  if (node.user_status === 'okay') return AlertTriangle;\n  return CheckCircle;\n};\n\nconst formatTimeAgo = (timestamp) => {\n  if (!timestamp) return 'Unknown';\n  const minutes = Math.floor((new Date() - new Date(timestamp)) / 60000);\n  if (minutes < 1) return 'just now';\n  if (minutes < 60) return `${minutes}m ago`;\n  if (minutes < 1440) return `${Math.floor(minutes / 60)}h ago`;\n  return `${Math.floor(minutes / 1440)}d ago`;\n};\n\n// Create a custom icon using SVG\nconst createCustomIcon = (color, isNeedHelp = false) => {\n  const svg = `\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 36\" width=\"32\" height=\"48\">\n      <path d=\"M12 0C5.4 0 0 5.4 0 12c0 7.2 12 24 12 24s12-16.8 12-24c0-6.6-5.4-12-12-12z\" fill=\"${color}\" stroke=\"#fff\" stroke-width=\"1\"/>\n      <circle cx=\"12\" cy=\"12\" r=\"5\" fill=\"#fff\"/>\n      ${isNeedHelp ? '<circle cx=\"12\" cy=\"12\" r=\"7\" fill=\"none\" stroke=\"#fff\" stroke-width=\"1\" opacity=\"0.5\"><animate attributeName=\"r\" values=\"7;10;7\" dur=\"1s\" repeatCount=\"indefinite\"/><animate attributeName=\"opacity\" values=\"0.5;0;0.5\" dur=\"1s\" repeatCount=\"indefinite\"/></circle>' : ''}\n    </svg>\n  `;\n  \n  return L.divIcon({\n    className: 'custom-map-marker',\n    html: svg,\n    iconSize: [32, 48],\n    iconAnchor: [16, 48],\n    popupAnchor: [0, -48],\n  });\n};\n\n// Pre-create icons for each status\nconst icons = {\n  good: createCustomIcon(statusColors.good, false),\n  okay: createCustomIcon(statusColors.okay, false),\n  need_help: createCustomIcon(statusColors.need_help, true),\n  offline: createCustomIcon(statusColors.offline, false),\n};\n\nconst getIconForNode = (node) => {\n  if (node.status === 'offline') return icons.offline;\n  if (node.user_status === 'need_help') return icons.need_help;\n  if (node.user_status === 'okay') return icons.okay;\n  return icons.good;\n};\n\n// Node popup content component\nconst NodePopupContent = ({ node }) => {\n  const StatusIcon = getStatusIcon(node);\n  const statusColor = getNodeStatusColor(node);\n  \n  return (\n    <div className=\"min-w-[180px] p-1\" data-testid={`map-popup-${node.node_id}`}>\n      <div className=\"font-semibold text-foreground text-sm mb-1\">{node.name}</div>\n      <div \n        className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium mb-2\"\n        style={{ backgroundColor: `${statusColor}20`, color: statusColor }}\n      >\n        <StatusIcon className=\"w-3 h-3\" />\n        {getStatusLabel(node)}\n      </div>\n      <div className=\"space-y-1 text-xs text-muted-foreground\">\n        <div className=\"flex justify-between\">\n          <span>Last seen:</span>\n          <span className=\"font-medium\">{formatTimeAgo(node.last_seen)}</span>\n        </div>\n        {node.gps ? (\n          <div className=\"flex justify-between\">\n            <span>Location:</span>\n            <span className=\"font-mono text-xs\">{node.gps.lat.toFixed(4)}, {node.gps.lon.toFixed(4)}</span>\n          </div>\n        ) : (\n          <div className=\"text-muted-foreground italic\">No GPS data</div>\n        )}\n        {node.role && (\n          <div className=\"flex justify-between\">\n            <span>Role:</span>\n            <span className=\"font-medium\">{node.role}</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default function LazyMapContent({ nodesWithGps, defaultCenter, defaultZoom, onMapReady }) {\n  const [isReady, setIsReady] = useState(false);\n  const mapRef = useRef(null);\n  \n  useEffect(() => {\n    // Small delay to ensure CSS is loaded\n    const timer = setTimeout(() => setIsReady(true), 50);\n    return () => clearTimeout(timer);\n  }, []);\n  \n  // Expose map reference to parent\n  useEffect(() => {\n    if (mapRef.current && onMapReady) {\n      onMapReady(mapRef.current);\n    }\n  }, [isReady, onMapReady]);\n  \n  if (!isReady) {\n    return (\n      <div className=\"h-[320px] lg:h-[450px] xl:h-[550px] glass rounded-lg flex items-center justify-center\">\n        <div className=\"text-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary mx-auto mb-2\" />\n          <p className=\"text-sm text-muted-foreground\">Initializing map...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <MapContainer\n      ref={mapRef}\n      center={defaultCenter}\n      zoom={defaultZoom}\n      className=\"h-[320px] lg:h-[450px] xl:h-[550px] w-full rounded-lg z-0\"\n      style={{ background: 'hsl(var(--muted))' }}\n      data-testid=\"ally-map-container\"\n    >\n      <TileLayer\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n      />\n      {nodesWithGps.map(node => {\n        const icon = getIconForNode(node);\n        if (!icon || !node.gps) return null;\n        \n        return (\n          <Marker\n            key={node.node_id}\n            position={[node.gps.lat, node.gps.lon]}\n            icon={icon}\n          >\n            <Popup>\n              <NodePopupContent node={node} />\n            </Popup>\n          </Marker>\n        );\n      })}\n    </MapContainer>\n  );\n}\n"],"names":["Popup","createOverlayComponent","props","context","popup","LeafletPopup","overlayContainer","createElementObject","element","_ref","setOpen","position","useEffect","instance","onPopupOpen","event","update","onPopupClose","map","on","popupopen","popupclose","setLatLng","openOn","bindPopup","_context$overlayConta","off","unbindPopup","removeLayer","statusColors","getStatusLabel","node","status","user_status","formatTimeAgo","timestamp","minutes","Math","floor","Date","concat","createCustomIcon","color","isNeedHelp","arguments","length","undefined","svg","L","className","html","iconSize","iconAnchor","popupAnchor","icons","good","okay","need_help","offline","NodePopupContent","StatusIcon","WifiOff","HelpCircle","AlertTriangle","CheckCircle","getStatusIcon","statusColor","getNodeStatusColor","_jsxs","node_id","children","_jsx","name","style","backgroundColor","last_seen","gps","lat","toFixed","lon","role","LazyMapContent","_ref2","nodesWithGps","defaultCenter","defaultZoom","onMapReady","isReady","setIsReady","useState","mapRef","useRef","timer","setTimeout","clearTimeout","current","MapContainer","ref","center","zoom","background","TileLayer","attribution","url","icon","getIconForNode","Marker","Loader2"],"ignoreList":[],"sourceRoot":""}