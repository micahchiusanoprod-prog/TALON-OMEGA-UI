{
  "manifest_version": "1.1.0",
  "build_version": "pi-1.1.0",
  "generated": "2026-01-21",
  "description": "Complete UI element inventory with dependencies and offline behavior",
  
  "system_health": {
    "description": "LOCAL service health, independent of WAN",
    "states": [
      {"state": "LOCAL_OK", "condition": "API + Kiwix responding", "ui": "Green status badge"},
      {"state": "LOCAL_DEGRADED", "condition": "Only one service up", "ui": "Yellow warning"},
      {"state": "LOCAL_DOWN", "condition": "Neither responding", "ui": "Red alert banner"}
    ],
    "endpoints_checked": [
      "/api/cgi-bin/health.py",
      "/kiwix/"
    ]
  },
  
  "pages": [
    {
      "id": "dashboard",
      "route": "/",
      "label": "OMEGA Dashboard",
      "type": "page",
      "dependencies": {
        "api": ["/api/cgi-bin/health.py"],
        "kiwix": ["/kiwix/"]
      },
      "offline_status": "works",
      "components": ["quick-access-panel", "quick-tools-bar", "search-bar", "ally-communications-hub", "tiles"]
    },
    {
      "id": "entertainment",
      "route": "/#/entertainment",
      "label": "Entertainment",
      "type": "page",
      "dependencies": {
        "jellyfin": [":8096"]
      },
      "offline_status": "degrades",
      "fallback": "Shows NOT_CONFIGURED with setup guide"
    }
  ],
  
  "quick_access_panel": {
    "id": "quick-access-panel",
    "testId": "quick-access-panel",
    "label": "Quick Access",
    "type": "panel",
    "location": "dashboard-top",
    "purpose": "SHTF first-screen access (<10 seconds to Kiwix, hotspot, status)",
    "offline_status": "works",
    "buttons": [
      {
        "id": "quick-access-kiwix",
        "testId": "quick-access-kiwix",
        "label": "Knowledge Base",
        "sublabel": "Offline Wiki",
        "action": "window.open('/kiwix/', '_blank')",
        "dependencies": ["/kiwix/"],
        "offline_status": "degrades"
      },
      {
        "id": "quick-access-status",
        "testId": "quick-access-status",
        "label": "System Status",
        "sublabel": "Health & Diagnostics",
        "action": "open_diagnostics_panel",
        "dependencies": ["/api/cgi-bin/health.py", "/api/cgi-bin/metrics.py"],
        "offline_status": "degrades"
      },
      {
        "id": "quick-access-hotspot",
        "testId": "quick-access-hotspot",
        "label": "WiFi Hotspot",
        "sublabel": "Connect Devices",
        "action": "scroll_to_hotspot_tile",
        "dependencies": [],
        "offline_status": "works"
      },
      {
        "id": "quick-access-comms",
        "testId": "quick-access-comms",
        "label": "Communications",
        "sublabel": "Mesh & Messages",
        "action": "scroll_to_comms_hub",
        "dependencies": ["/api/cgi-bin/mesh.py"],
        "offline_status": "degrades"
      }
    ],
    "direct_link": {
      "testId": "quick-access-kiwix-direct",
      "label": "Open Kiwix Library Directly",
      "href": "/kiwix/",
      "target": "_blank"
    }
  },
  
  "search": {
    "id": "search-bar",
    "testId": "search-bar",
    "label": "Search everything...",
    "type": "input",
    "dependencies": {
      "kiwix": ["/kiwix/search?pattern=X&limit=20"]
    },
    "note": "/kiwix/suggest returns 404 - NOT USED",
    "offline_status": "degrades",
    "fallback": "Shows 'Kiwix Unavailable' banner with retry option",
    "scopes": ["Global", "Knowledge", "Media", "Community", "Files", "Tools"]
  },
  
  "api_error_handlers": {
    "description": "Clean error display for Pi-specific responses",
    "handlers": [
      {
        "id": "DM_FORBIDDEN",
        "trigger": "403 response from /api/cgi-bin/dm.py",
        "response_pattern": "{\"ok\":false,\"err\":\"forbidden\"}",
        "ui_title": "Direct Messages - Setup Required",
        "ui_description": "Direct messaging has not been configured on this OMEGA device.",
        "next_actions": ["View Setup Guide", "Check System Status", "Return to Dashboard"],
        "offline_tip": "Contact your network administrator to enable direct messaging."
      },
      {
        "id": "SENSORS_ERROR",
        "trigger": "{\"status\":\"error\"} from /api/cgi-bin/sensors.py",
        "response_pattern": "{\"status\":\"error\",\"error\":\"...i2c...\"}",
        "ui_title": "Environmental Sensors - Hardware Issue",
        "ui_description": "Unable to read from the BME680 sensor.",
        "next_actions": ["View Hardware Guide", "Retry Connection", "Return to Dashboard"],
        "offline_tip": "Check that the BME680 sensor is properly connected to the I2C bus."
      },
      {
        "id": "GPS_ERROR",
        "trigger": "{\"status\":\"error\"} from /api/cgi-bin/gps.py",
        "response_pattern": "{\"status\":\"error\",\"error\":\"gpspipe timeout...\"}",
        "ui_title": "GPS - No Signal",
        "ui_description": "Unable to get GPS coordinates.",
        "next_actions": ["Enter Location Manually", "View Saved Waypoints", "Retry GPS", "Return to Dashboard"],
        "offline_tip": "Move to an area with clear sky view, or manually enter your coordinates."
      },
      {
        "id": "KIWIX_UNAVAILABLE",
        "trigger": "Cannot reach /kiwix/",
        "ui_title": "Knowledge Base - Unavailable",
        "next_actions": ["Retry Connection", "Check System Status", "Return to Dashboard"],
        "offline_tip": "Verify that kiwix-serve is running on the Pi."
      }
    ]
  },
  
  "tiles": [
    {
      "id": "ally-communications-hub",
      "label": "Ally Communications Hub",
      "dependencies": ["/api/cgi-bin/mesh.py"],
      "offline_status": "degrades"
    },
    {
      "id": "environment-tile",
      "label": "Environment",
      "dependencies": ["/api/cgi-bin/sensors.py"],
      "offline_status": "degrades",
      "error_handling": "Shows SENSORS_ERROR handler on {status:error}"
    },
    {
      "id": "device-info-tile",
      "label": "Device Status",
      "dependencies": ["/api/cgi-bin/metrics.py"],
      "offline_status": "degrades"
    },
    {
      "id": "hotspot-tile",
      "label": "Hotspot",
      "dependencies": [],
      "offline_status": "works",
      "note": "Shows static instructions, no backend required"
    },
    {
      "id": "power-tile",
      "label": "Power",
      "dependencies": [],
      "offline_status": "works"
    },
    {
      "id": "weather-tile",
      "label": "Weather",
      "dependencies": [],
      "offline_status": "works"
    },
    {
      "id": "security-tile",
      "label": "Security",
      "dependencies": ["localStorage:omega_profiles"],
      "offline_status": "works"
    }
  ],
  
  "modals": [
    {
      "id": "admin-console-modal",
      "has_return_button": true,
      "tabs": ["Fleet Updates", "Roster & Readiness", "Broadcast", "Search Health", "Data Health", "Audit"]
    },
    {
      "id": "help-center-modal",
      "has_return_button": true,
      "offline_status": "works"
    },
    {
      "id": "diagnostics-panel",
      "has_return_button": true,
      "dependencies": ["/api/cgi-bin/health.py", "/api/cgi-bin/metrics.py"]
    }
  ],
  
  "escape_hatches": {
    "description": "Every modal/error state has 'Return to Dashboard'",
    "methods": [
      "Close button (X) in modal header",
      "Escape key",
      "'Return to Dashboard' button in error states",
      "Click outside modal backdrop"
    ]
  },
  
  "localStorage_keys": [
    {"key": "omega-theme", "purpose": "Light/dark theme", "default": "dark"},
    {"key": "omega-field-notes", "purpose": "User notes", "default": ""},
    {"key": "omega-recent-searches", "purpose": "Search history", "default": "[]"},
    {"key": "omega_profiles", "purpose": "Family profiles", "default": "[]"}
  ]
}
